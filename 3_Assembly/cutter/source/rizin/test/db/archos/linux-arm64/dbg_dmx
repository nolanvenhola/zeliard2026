NAME=dmxa/dmxb/dmxe with 64-bit jemalloc 5.3.0 runtime (aarch64-linux-)
FILE=bins/heap/simpleheap-jemalloc-5.3.0-static-aarch64
ARGS=-d
CMDS=<<EOF
dcu sym.imp.getchar
dmxa~?narenas
echo ----
dmxb~reg_size : 0x800
echo ----
dmxe~Total extents found:
EOF
EXPECT=<<EOF
1
----
      reg_size : 0x800
----
Total extents found: 16
EOF
RUN

NAME=dmxa/dmxb with jemalloc 4.5.0 memory dump (linux-amd64-4k_page)
FILE=bins/heap/linux_jemalloc-4.5.0_x64.bin
ARGS=-n
CMDS=<<EOF
e asm.arch=x86
e asm.bits=64
e asm.os=linux
e dbg.jemalloc.version=4.5.0
e dbg.jemalloc.page_size=4k

om 3 0x7f2601a03c00 0x8 0x0 rw- je_arenas
om 3 0x7f2601f5b2d0 0x4 0x8 rw- narenas_total
om 3 0x7f2601f5b380 0x900 0xc rw- je_arena_bin_info
om 3 0x7f2601a00140 0x2758 0x90c rw- arena
om 3 0x7f2601800000 0x200000 0x3064 rw- [heap]

dmxa 0x7f2601a00140~ind
dmxa 0x7f2601a00140~nthreads: application
dmxa 0x7f2601a00140~extent_sn_next
dmxa 0x7f2601a00140~spare
dmxa 0x7f2601a00140~purging
dmxa 0x7f2601a00140~nactive
dmxa 0x7f2601a00140~bins
echo ----
dmxb 0x7f2601a00140 0x7f2601f5b380~?regsize
dmxb 0x7f2601a00140 0x7f2601f5b380~regsize : 0x800
dmxb 0x7f2601a00140 0x7f2601f5b380~regsize : 0x3800
dmxb 0x7f2601a00140 0x7f2601f5b380~nregs : 0x200
EOF
EXPECT=<<EOF
  ind = 0x0
  nthreads: application allocation = 0x1
  extent_sn_next = 0x1
  spare = 0x0
  purging = false
  nactive = 0xc
  bins = 36 0x7f2601a00ac0
----
36
       regsize : 0x800
       regsize : 0x3800
       nregs : 0x200
EOF
RUN


NAME=dmxa/dmxb/dmxei with jemalloc 5.3.0 memory dump (linux-amd64-4k_page)
FILE=bins/heap/linux_jemalloc-5.3.0_x64.bin
ARGS=-n
CMDS=<<EOF
e asm.arch=x86
e asm.bits=64
e asm.os=linux
e dbg.jemalloc.version=5.3.0
e dbg.jemalloc.page_size=4k

om 3 0x561974e68b00 1440 0x0 rw- bin_info
om 3 0x7faa2cc010c0 0x20000 1440 rw- arena
om 3 0x7faa2cc16500 128 0x205a0 rw- extent

dmxa 0x7faa2cc010c0~ind
dmxa 0x7faa2cc010c0~nthreads: application
dmxa 0x7faa2cc010c0~stats
dmxa 0x7faa2cc010c0~dss_prec
dmxa 0x7faa2cc010c0~create_time.ns
echo ----
dmxb 0x7faa2cc010c0 0x561974e68b00~?reg_size
dmxb 0x7faa2cc010c0 0x561974e68b00~reg_size : 0x800
dmxb 0x7faa2cc010c0 0x561974e68b00~reg_size : 0x3800
dmxb 0x7faa2cc010c0 0x561974e68b00~nregs : 0x200
echo ----
dmxei 0x7faa2cc16500~Extent
dmxei 0x7faa2cc16500~Allocated Address
EOF
EXPECT=<<EOF
  ind = 0x0
  nthreads: application allocation = 0x1
  stats = 0x7faa2cc010d8
  dss_prec = 0x2
  create_time.ns = 0x1a488a2868dea
----
36
      reg_size : 0x800
      reg_size : 0x3800
      nregs : 0x200
----
Extent @ 0x7faa2cc16500
  Allocated Address: 0x7faa2ca00000
EOF
RUN

NAME=dmxa/dmxb/dmxei with jemalloc 5.3.0 memory dump (linux-riscv64-4k_page)
FILE=bins/heap/linux_jemalloc-5.3.0_riscv64.bin
ARGS=-n
CMDS=<<EOF
e asm.arch=riscv
e asm.bits=64
e asm.os=linux
e dbg.jemalloc.version=5.3.0
e dbg.jemalloc.page_size=4k

om 3 0x55555d5b4830 1440 0x0 rw- bin_info
om 3 0x7fff960010c0 0x20000 1440 rw- arena
om 3 0x7fff96016500 128 0x205a0 rw- extent

dmxa 0x7fff960010c0~ind
dmxa 0x7fff960010c0~nthreads: application
dmxa 0x7fff960010c0~stats
dmxa 0x7fff960010c0~dss_prec
dmxa 0x7fff960010c0~create_time.ns
echo ----
dmxb 0x7fff960010c0 0x55555d5b4830~?reg_size
dmxb 0x7fff960010c0 0x55555d5b4830~reg_size : 0x800
dmxb 0x7fff960010c0 0x55555d5b4830~reg_size : 0x3800
dmxb 0x7fff960010c0 0x55555d5b4830~nregs : 0x200
echo ----
dmxei 0x7fff96016500~Extent
dmxei 0x7fff96016500~Allocated Address
EOF
EXPECT=<<EOF
  ind = 0x0
  nthreads: application allocation = 0x1
  stats = 0x7fff960010d8
  dss_prec = 0x2
  create_time.ns = 0x35366573ac
----
36
      reg_size : 0x800
      reg_size : 0x3800
      nregs : 0x200
----
Extent @ 0x7fff96016500
  Allocated Address: 0x7fff95e00000
EOF
RUN
